!function(r){window.tfaInitTelConfirmation||(window.tfaInitTelConfirmation=function(t){var n="tfa-verified-tel";if(window.tfa_tel_confirmation){var o=t.find(tfa_tel_confirmation.input_selector);if(o.length){if(tfa_tel_confirmation.add_button){var a=r('<span class="button tfa-tel-verify"></span>');function e(){a&&(o.val()?(a.show(),o.val()&&o.val()==o.data(n)?(a.text(tfa_tel_confirmation.verified_caption),a.addClass("tfa-tel-verified")):(a.addClass("button"),a.text(tfa_tel_confirmation.verify_caption),a.removeClass("tfa-tel-verified"))):a.hide())}tfa_tel_confirmation.verified_number&&o.data(n,tfa_tel_confirmation.verified_number),a.insertAfter(o),a.on("click",function(){o.val()&&o.val()!=o.data(n)&&tfaLoadPopup({data:{action:"tfa_confirm_phone_number",tel:o.val()}},{onLoad:function(a){a&&a.find("form").data("json-submit-success",function(t){t.error?tfaShowError(t.error):t.success&&(o.val(t.tel),o.data(n,t.tel),tfaClosePopup(a))})}})}),o.on("change keyup",function(){e()}),e()}if(window.tfaTelNumberSubmit=function(t){if(o.data(n)==o.val())return!0;t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),i.find("[type=submit]").removeAttr("disabled");var e={onLoad:function(t){var a=t.find("[name=tel]");a.attr("readonly","readonly"),a.val(o.val());var n=t.find("form");n.on("submit",function(t){t.preventDefault(),r.ajax({url:n.attr("action"),method:n.attr("method"),data:n.serialize(),dataType:"json",success:function(t){e.onSuccess(t)}})})},onSuccess:function(t){t.error?tfaShowError(t.error):t.success&&(t.tel&&o.val(t.tel),o.data("changed",null),HTMLFormElement.prototype.submit.call(i[0]))}};return tfaLoadPopup({data:{action:"tfa_confirm_phone_number",tel:o.val()}},e),!1},tfa_tel_confirmation.require){var i=o.closest("form");i.length&&i[0].setAttribute("onsubmit","return tfaTelNumberSubmit.call(this, event)")}}}}),window.tfaInitCallbacks||(window.tfaInitCallbacks=[]),tfaInitCallbacks.push(tfaInitTelConfirmation)}(jQuery);