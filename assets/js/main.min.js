function tfaAddHidden(t,a,o,n){var e=document.createElement("input");return e.type="hidden",e.name=a,void 0!==o&&(e.value=o),n?jQuery(e).insertBefore(t):jQuery(e).appendTo(t),e}!function($){window.tfaInitCallbacks||(window.tfaInitCallbacks=[]),window.tfaInit=function(a){tfaInitJsonForm(a),tfaInitQrCode(a),tfaInitCallbacks.forEach(function(t){t(a)}),a.find(".tfa-focus").focus()};var $doc=$(document);$doc.ready(function(){$doc.on("click",".tfa-popup-link",function(t){var a=$(this);t.preventDefault(),tfaLoadPopup({url:a.data("popup-url")},a.data("popup-config"))}),$doc.on("click",".tfa-popup-wrapper",function(t){if(t.target===this){var a=$(this);a.hasClass("tfa-modal")||a.remove()}}),$doc.on("click",".tfa-popup-close",function(t){this.closest(".tfa-modal")||tfaClosePopup(this)}),tfaInit($doc)}),window.tfaShow2FAPopup||(window.tfaShow2FAPopup=function(t,e,a){a=Object.assign({url:tfa_main.ajax_url,dataType:"json",data:Object.assign({action:"tfa_popup"},t),success:function(t){if("object"!=typeof t||t.skip)return e();t.error?tfaShowError(t.error,"error"):(t.onLoad=function(o){var n=o.find("form");n.on("submit",function(t){t.preventDefault();var a=n.find("[type=submit]");$.ajax({dataType:"json",method:"post",url:n.attr("action"),data:n.serialize(),success:function(t){a.removeAttr("disabled"),t.error||t.error_message?tfaShowError(t.error||t.error_message):t.message?tfaShowMessage(t.message):t.token&&(tfaClosePopup(o),t.popup?tfaPopup({content:t.popup,popupCallback:function(){"function"==typeof e&&e(t.token)}}):"function"==typeof e&&e(t.token))}}),a.attr("disabled","disabled")})},tfaPopup(t))}},a||{}),$.ajax(a)}),window.tfaPopup||(window.tfaPopup=function(data){if(data.error)tfaShowError(data.error);else if(data.message)tfaShowMessage(data.message);else if(data.skip)"function"==typeof data.onSuccess&&data.onSuccess(data);else if(data.content){if("string"==typeof data.content){var callbackId=addCallback(data.popupCallback);if(data.popupCallback&&(data.content=data.content.replace("true_factor_auth_popup_callback","tfaCallback("+callbackId+")")),"function"===data.content.substring(0,8))return eval("var fn = "+data.content),void fn(data);data.title&&(data.content='<div class="tfa-popup-title">'+data.title+"</div>"+data.content)}var $content=$('<div class="tfa-popup-wrapper"><div class="tfa-popup">'+data.content+"</div></div>");$content.appendTo(document.body),data.popupClass&&$content.addClass(data.popupClass),tfaInit($content),"function"==typeof data.onLoad&&data.onLoad($content)}}),window.tfaClosePopup||(window.tfaClosePopup=function(t){($(t).closest(".tfa-popup-wrapper")||t).remove()}),window.tfaShowMessage||(window.tfaShowMessage=function(t,a){a||(a={}),a.content||(a.content='<div class="tfa-popup-text">'+t+"</div>"),a&&a.footerCloseButton&&(a.content+='<div class="tfa-popup-footer"><button type="button" class="button button-cancel tfa-popup-close tfa-focus">'+(tfa_main.t_close||"Close")+"</button></div>"),tfaPopup(a)}),window.tfaShowError||(window.tfaShowError=function(t){return tfaShowMessage(t,{title:tfa_main.t_error||"Error",popupClass:"error",footerCloseButton:!0})}),window.tfaLoadPopup=function(t,a){$.ajax(Object.assign({url:tfa_main.ajax_url,dataType:"json",success:function(t){tfaPopup(Object.assign(t,a||{}))}},t))},window.true_factor_auth_popup_callback=function(){};var callbacks=[];function addCallback(t){return callbacks.push(t),callbacks.length-1}window.tfaCallback=function(t){return callbacks[t]},window.tfaInitJsonForm||(window.tfaInitJsonForm=function(a){var o=a.find(".tfa-json-form");if(o.length){var n=o.find("[type=submit]");o.on("submit",function(t){t.preventDefault(),$.ajax({url:o.attr("action"),method:o.attr("method"),dataType:"json",data:o.serialize(),success:function(t){n.removeAttr("disabled"),t.error||t.error_message?tfaShowError(t.error||t.error_message):(t.message&&tfaShowMessage(t.message),t.popup&&tfaPopup({content:t.popup}),t.success&&(tfaClosePopup(a),o.hasClass("tfa-json-form-reload-on-success")&&location.reload()),t.redirect&&(location.href=t.redirect))},complete:function(){n.removeAttr("disabled")}}),n.attr("disabled","disabled")})}}),window.tfaInitQrCode||(window.tfaInitQrCode=function(t){t.find(".js-qrcode").each(function(t,a){$(a).qrcode({render:"image",text:$(a).data("qr"),size:$(a).width()||200})})})}(jQuery);